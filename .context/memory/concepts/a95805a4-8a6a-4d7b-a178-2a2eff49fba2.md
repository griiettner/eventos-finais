---
id: "a95805a4-8a6a-4d7b-a178-2a2eff49fba2"
title: "Database Schema and Architecture"
type: "concept"
tags: ["database","sqlite","schema","architecture","offline"]
created: "2026-01-05T04:31:02.460Z"
updated: "2026-01-05T04:31:02.460Z"
related: ["database","sqlite","architecture","offline-first"]
importance: 0.7
---

# Database Schema and Architecture

# Database Schema and Architecture

Eventos Finais uses SQLite WASM with Web Worker for offline-first data storage and management.

## Database Technology
- **SQLite WASM**: In-browser database with full SQL support
- **Web Worker**: Non-blocking database operations
- **OPFS Storage**: Persistent file system storage when available
- **Fallback**: Transient storage for older browsers

## Core Tables

### chapters
```sql
CREATE TABLE chapters (
  id INTEGER PRIMARY KEY,
  title TEXT NOT NULL,
  summary TEXT,
  content TEXT,
  audio_url TEXT,
  order_index INTEGER,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### questions
```sql
CREATE TABLE questions (
  id INTEGER PRIMARY KEY,
  chapter_id INTEGER NOT NULL,
  text TEXT NOT NULL,
  order_index INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (chapter_id) REFERENCES chapters(id) ON DELETE CASCADE
);
```

### user_answers
```sql
CREATE TABLE user_answers (
  chapter_id INTEGER,
  question_id INTEGER,
  answer TEXT,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  synced INTEGER DEFAULT 0,
  PRIMARY KEY (chapter_id, question_id),
  FOREIGN KEY (chapter_id) REFERENCES chapters(id) ON DELETE CASCADE,
  FOREIGN KEY (question_id) REFERENCES questions(id) ON DELETE CASCADE
);
```

### progress
```sql
CREATE TABLE progress (
  chapter_id INTEGER PRIMARY KEY,
  is_read INTEGER DEFAULT 0,
  audio_progress REAL DEFAULT 0,
  FOREIGN KEY (chapter_id) REFERENCES chapters(id) ON DELETE CASCADE
);
```

### user_profile
```sql
CREATE TABLE user_profile (
  id INTEGER PRIMARY KEY CHECK (id = 1),
  username TEXT,
  email TEXT,
  is_verified INTEGER DEFAULT 0,
  is_admin INTEGER DEFAULT 0
);
```

## Architecture Pattern
- **DBService**: Facade pattern for database operations
- **Web Worker**: Isolates database operations from main thread
- **AdminService**: Business logic for content management
- **Sync Manager**: Handles offline/online synchronization

## Performance Optimizations
- Database operations in Web Worker prevent UI blocking
- Foreign key constraints ensure data integrity
- Indexes on frequently queried columns
- Transaction support for complex operations

## Data Flow
1. User interactions trigger service calls
2. Services use DBService facade
3. DBService communicates with Web Worker
4. Web Worker executes SQL operations
5. Results flow back through service layer
6. UI updates with new data